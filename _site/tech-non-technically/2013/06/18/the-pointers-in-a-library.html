<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Lines and Sticks - Recle Strife 图书馆里谈指针</title>

    <link rel="stylesheet" href="../../../../stylesheets/styles.css">
    <link rel="stylesheet" href="../../../../stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Lines and Sticks</h1>
<p> where information aligns</p>

      </header>
      <section>
        <h2><a href="/tech-non-technically/2013/06/18/the-pointers-in-a-library.html">图书馆里谈指针</a></h2>
		    <p>常听说初学者不太容易理解编程语言中的指针，这里试着打个比方解释一下。</p>

<blockquote>
<p>有一个图书馆，里面有很多书架用来放书，每一个书架又有若干层，每层可以放一本书，也可以放多本，但是不存在书本太厚连一本都放不下的情况。有的长篇著作比如金庸系列一层放不下，就只能放在多层。</p>

<p>为了方便管理，每个书架的每一层都有唯一的编号，并且是连续的。这样只要知道一本书对应的书架编号就很容易找到。</p>

<p>有时候，读者可以预约借哪本书，网上登记后管理员将编号打印出来，等读者上门后去取书。图书馆没有桌子，于是管理员就把打印好的编号放在门口的空书架上。</p>

<p>有时候，刚还回来的书被临时放在某个书架上，并且在还书的时候就打印一个临时的书架编号，这些打印的编号也被放在了某个书架上以便管理员过后整理，他看到编号就知道哪个书架上的书需要整理。</p>
</blockquote>

<p>图书馆的所有书架就相当于整台计算机的内存，书架的每一层是内存的最小存储单位，编号就是内存地址，连续且唯一。可以想象，指针就是那些打印了编号的纸片，并且也被放在了书架上。</p>

<p>至此，我们给出了指针最主要的特征：指针通过内存地址间接的表示了某些内容，指针本身也存储在内存中。 也就是说指针本身也有地址，就好比纸片上的编号对应的书架可能放的是另外一张纸片。</p>

<h3 id='id181'>指针的类型</h3>

<p>其实这个例子中还是包含一些误导，就是关于占用内存空间大小的问题，如果每一层书架对应内存的最小寻址单位，一般来说是一个字节，那么在32位的系统中（即4GB的寻址空间，存储一个地址所需要的空间是2^32比特，即4个字节），也就是说一张纸片需要占据4层书架，要把这个概念也强加进来这个例子将会变得非常虐心。（想一想64位的系统是什么情况？）</p>

<p>另外，假设你不知道金庸，给你一个编号叫你把金庸全集拿过来，怎么破？你找到了书架但是怎么知道相邻层上的书是不是金庸？这就意味着一个地址是不够的，还得告诉你指针指向的内容占多大的空间。也就是每个纸片上除了一个书架编号以外，还需要一个数字说明连续多少层架子上的书都算在里面。</p>

<p>在编程语言中，通常通过定义指针的类型说明目标数据的类型，也就知道了占多大空间，比如整型占4个字节，双精度浮点型占8个字节，等等。 至此，我们澄清了指针的另一个重要特性：指针标识了目标数据的起始位置，同时，通过类型说明目标数据所占的空间。</p>

<h3 id='id182'>指针的运算</h3>

<p>说白了指针的存储的就是一个整数，因此整数的运算理论上都适用于指针，只是运算得到的结果是否是一个合法的地址罢了。有的编程语言允许改变指针的值，甚至连指针的类型都可以强制改变，可以想象这种灵活性，但代价是，为了保证正确性和安全性，程序员需要花费大量的精力进行维护。</p>

<p>这也是更多“高级”语言的设计者经常要考虑的问题之一。</p>

<h3 id='id183'>引用又是怎么回事</h3>

<p>引用在不同语言中的含义可能不同。</p>

<p>在<code>C++</code>中，引用只是同一内容的别名，在运行时并不会像指针一样分配一个整型的空间并存储一个地址。就好像图书管理员之间在口头交流却从来不把编号打印出来一样：“小X，去把9527上的《C程序设计》拿过来”。</p>

<p>在<code>C#</code>或<code>Java</code>中，引用其实就是指针，只是编译器和虚拟机限制了大多数对指针的操作，比如运算，比如强制类型转换，而主要利用指针的间接指向的功能。</p>

<h3 id='id184'>指针为什么会这么复杂</h3>

<p>如果上面的描述很容易理解，那么指针究竟复杂在哪里呢？ 其实，很多让初学者凌乱的地方并不是指针本身，而往往是运行环境、编程语言等的复杂性，比如奇葩的指针类型（void*，函数指针，各种const前前后后分不清楚），指针的运算，指针访问数组，指针类型转换（强转），错误的地址值（为空、未初始化），数据（资源）的分配和释放，以及各种语言及库的设计缺陷等等。</p>

<p>OK，我已经为你找了这么多借口，但现实是，复杂或繁琐的东西（特别是本不该复杂确被搞复杂的东西）回避不掉，不如坦然面对吧，也因为这些烂摊子，你的价值才得以体现。</p>
      </section>
      <footer>
        <!--<p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>-->
      </footer>
    </div>
    <script src="../../../../javascripts/scale.fix.js"></script>
    
  </body>
</html>